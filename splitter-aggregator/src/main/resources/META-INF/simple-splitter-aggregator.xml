<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:int="http://www.springframework.org/schema/integration"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean id="brokerQuoteRequestSplitter"/>

    <executor xmlns="http://www.springframework.org/schema/task" id="service-threads"
              pool-size="10-15" queue-capacity="25"
              rejection-policy="CALLER_RUNS"/>

    <int:channel id="broker-request-error-channel">
        <int:interceptors>
            <int:wire-tap channel="logging-channel"/>
        </int:interceptors>
    </int:channel>

    <int:logging-channel-adapter id="logging-channel" level="INFO" log-full-message="true"/>


    <int:gateway id="brokerRequestGateway"
                 service-interface="com.l8mdv.sample.gateway.BrokerRequestGateway"
                 error-channel="broker-request-error-channel"
                 default-request-channel="broker-request-service-channel"
                 default-request-timeout="8000"
                 default-reply-timeout="8000"/>

    <int:channel id="broker-request-service-channel" datatype=""/>
    <int:splitter id="requestSplitter" ref="brokerQuoteRequestSplitter" input-channel="broker-request-service-channel"
                  output-channel="broker-request-router-channel" apply-sequence="true"/>

    <int:channel id="broker-request-router-channel"/>

    <int:recipient-list-router>
        <int:recipient channel="broker-a" selector-expression="payload.getBrokerName().equalsIgnoreCase('BrokerA')"/>
        <int:recipient channel="broker-b" selector-expression="payload.getBrokerName().equalsIgnoreCase('BrokerB')"/>
    </int:recipient-list-router>

    <int:channel id="broker-a"/>
    <int:channel id="broker-b"/>
</beans>
